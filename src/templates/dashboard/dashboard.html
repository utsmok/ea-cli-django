{% extends "base.html" %}

{% block content %}
<div class="p-4" x-data="{ showUploadModal: false }">

    <!-- Toolbar -->
    <div class="flex justify-between mb-4">
        <h1 class="text-2xl font-bold">Copyright Dashboard</h1>
        <div class="flex gap-2">
            <button class="btn btn-outline btn-info" hx-post="{% url 'enrichment:trigger_batch' %}"
                hx-confirm="Are you sure you want to enrich all items? This might take a while." hx-swap="none">
                Enrich All
            </button>
            <a class="btn" href="{% url 'api:download_faculty_sheets' %}">
                Download faculty sheets
            </a>
            <button @click="showUploadModal = true" class="btn btn-primary">
                Upload Excel
            </button>
        </div>
    </div>

    <!-- The Grid (HTMX Target) -->
    <div id="data-grid" hx-get="{% url 'dashboard:grid_partial' %}" hx-trigger="load">
        <!-- Spinner while loading -->
        <span class="loading loading-spinner loading-lg"></span>
    </div>

    <!-- Upload Modal (DaisyUI + Alpine) -->
    <dialog class="modal" :class="{ 'modal-open': showUploadModal }">
        <div class="modal-box">
            <h3 class="font-bold text-lg">Upload Data</h3>
            <form hx-post="{% url 'api:trigger_ingest' %}" hx-swap="none" hx-encoding="multipart/form-data"
                enctype="multipart/form-data" @htmx:after-request="showUploadModal = false">
                {% csrf_token %}

                <label class="form-control w-full max-w-xs">
                    <div class="label"><span class="label-text">Source type</span></div>
                    <select name="source_type" class="select select-bordered">
                        <option value="QLIK">Qlik export</option>
                        <option value="FACULTY">Faculty sheet</option>
                    </select>
                </label>

                <label class="form-control w-full max-w-xs mt-2">
                    <div class="label"><span class="label-text">Faculty code (for faculty sheets)</span></div>
                    <input type="text" name="faculty_code" placeholder="EEMCS" class="input input-bordered" />
                </label>

                <input type="file" name="file" class="file-input w-full max-w-xs" />
                <div class="modal-action">
                    <button type="submit" class="btn btn-success">Upload</button>
                    <button type="button" class="btn" @click="showUploadModal = false">Close</button>
                </div>
            </form>
        </div>
    </dialog>

</div>
{% endblock %}
